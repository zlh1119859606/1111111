# 🎵 音频系统排查清单

## 📋 快速诊断步骤

### 第一步：检查浏览器控制台

1. **打开网站**，按 `F12` 打开开发者工具
2. **切换到 Console（控制台）标签**
3. **查看是否有红色错误信息**：
   - ❌ 404 错误 → 文件路径问题
   - ❌ CORS 错误 → 跨域问题
   - ❌ 其他错误 → 记录错误信息

### 第二步：运行诊断工具

在控制台输入以下命令：

```javascript
debugAudioSystem()
```

**查看输出结果**：
- ✅ 所有音频 `readyState: 4` → 文件加载正常
- ⚠️ `readyState < 4` → 文件未完全加载
- ❌ 有 `error` → 文件加载失败

### 第三步：检查音频文件路径

在控制台输入：

```javascript
document.querySelectorAll('audio source').forEach(s => console.log(s.src))
```

**检查路径格式**：
- ✅ 绝对路径（`https://...` 或 `/assets/...`）→ 正常
- ⚠️ 相对路径（`assets/...`）→ 可能在GitHub Pages上失效

### 第四步：测试单个音频

在控制台输入：

```javascript
testAudio('bgm')        // 测试背景音乐
testAudio('sound-dao')  // 测试"道"章节音效
```

**预期结果**：
- ✅ 听到声音 → 音频正常
- ❌ 无声音或报错 → 继续排查

### 第五步：手动激活音频

在控制台输入：

```javascript
activateAllAudio()
```

然后再次测试播放。

---

## 🔍 常见问题排查

### 问题1：BGM 无法自动播放

**症状**：页面加载后，BGM 没有声音

**排查步骤**：
1. 检查是否进行了用户交互（点击、滚动）
2. 查看控制台是否有 "🎵 音频已解锁" 日志
3. 点击左下角的音频控制按钮，手动播放

**解决方案**：
- 确保用户已进行交互（点击或滚动页面）
- 如果仍无法播放，检查浏览器是否阻止了自动播放

### 问题2：章节音效无法触发

**症状**：滚动到"道"章节时，没有音效

**排查步骤**：
1. 打开控制台，查看是否有 "尝试播放: dao_enter" 日志
2. 检查 `IntersectionObserver` 是否正常工作
3. 运行 `debugAudioSystem()` 检查音频文件状态

**解决方案**：
- 确保音频文件已加载（`readyState === 4`）
- 确保已进行用户交互（激活音频）
- 检查章节元素是否存在（`.dao-section`）

### 问题3：GitHub Pages 上音频无法加载

**症状**：本地正常，上线后无法播放

**排查步骤**：
1. 检查文件路径是否为相对路径
2. 访问音频文件URL，确认文件存在
   - 例如：`https://你的用户名.github.io/仓库名/assets/audio/bgm_ambient.mp3`
3. 检查 GitHub Pages 设置中的源目录

**解决方案**：
- 使用绝对路径（以 `/` 开头）
- 或使用 `fixAudioPaths()` 函数自动修复路径

### 问题4：音频文件 404 错误

**症状**：控制台显示 404 Not Found

**排查步骤**：
1. 确认文件存在于 `assets/audio/` 目录
2. 检查文件名大小写是否匹配
3. 检查文件是否已提交到 Git 仓库

**解决方案**：
- 确认文件路径和文件名完全正确
- 重新提交文件到 Git 仓库
- 等待 GitHub Pages 重新部署

---

## 🛠️ 调试工具使用

### 1. `debugAudioSystem()`
全面诊断音频系统，输出详细状态报告。

### 2. `testAudio(audioId)`
测试指定音频元素是否可以播放。

**示例**：
```javascript
testAudio('bgm')
testAudio('sound-dao')
```

### 3. `activateAllAudio()`
强制激活所有音频元素（用于调试）。

---

## 📝 检查清单

- [ ] 浏览器控制台无红色错误
- [ ] 所有音频文件 `readyState === 4`
- [ ] 音频文件路径正确（绝对路径或已修复）
- [ ] 已进行用户交互（点击/滚动）
- [ ] BGM 可以手动播放（点击控制按钮）
- [ ] 章节音效可以触发（滚动到对应章节）
- [ ] 交互音效可以触发（悬停工具/卡片）

---

## 💡 最佳实践

1. **开发环境**：
   - 使用相对路径 `assets/audio/xxx.mp3`
   - 启用调试面板（取消注释 `createDebugPanel()`）

2. **生产环境**：
   - 使用绝对路径 `/assets/audio/xxx.mp3` 或启用路径修复
   - 注释掉调试面板代码
   - 确保所有音频文件已正确部署

3. **测试流程**：
   - 本地测试 → 提交代码 → GitHub Pages 部署 → 在线测试
   - 每次部署后运行 `debugAudioSystem()` 验证

---

## 🆘 仍无法解决？

如果按照以上步骤仍无法解决问题，请提供以下信息：

1. 浏览器控制台的完整错误信息
2. `debugAudioSystem()` 的完整输出
3. 音频文件的URL（尝试直接访问）
4. GitHub Pages 仓库设置截图

---

**最后更新**：2024年

